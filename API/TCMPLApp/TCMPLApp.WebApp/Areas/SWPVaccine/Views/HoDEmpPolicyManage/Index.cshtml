@model TCMPLApp.WebApp.Models.SwpVuEmpResponseModel
@{
ViewData["Title"] = "Hod Pending Approvals";
Html.AntiForgeryToken();
}

@{
UserIdentity currentUserIdentity = CurrentUserIdentity;
}

@section styles
{
<link href="@Url.Content("~/css/drome-style.css")" rel="stylesheet" type="text/css" asp-append-version="true" />
}

@section BreadCrumbs
{
<ol class="breadcrumb">
    <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Home" asp-area="SWPVaccine">SWPVaccine</a></li>
    <li class="breadcrumb-item active">HOD Approvals</li>
</ol>
}

@{
ViewData["Title"] = "HOD Approvals";

}

<form asp-action="Index" method="post" name="FormIndex">

<div class="container-fluid bg-white border card rounded shadow m-auto col-xl-11 p-2 ">
    <div class="app-h4 app-card-header mb-2">
        <p>HOD Approvals</p>
    </div>
    <div class="card-toolbar">
        <div role="toolbar">
            <div class="row p-2">
                <div class="col-md-12">
                    <div class="row">

                        <div class="col-md-9 text-left">
                            <button name="approveSelected" id="approveSelected"
                                    type="submit" asp-action="Approve"
                                    class="btn btn-outline-primary btn-sm border-white">
                                <i class="fas fa-plus"></i>
                                Approve Selected
                            </button>
                        </div>
                        <div class="col-md-3 ">
                            <select class="form-control Select2 " id="ddlFilterList" name="ddlFilterList"
                                    onchange="this.form.submit();"
                                    asp-items="@(new SelectList(Model.HodfilterList,"Value","Text", ViewData["FilterVal"]))">
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="m-1"></div>
    <div class="bg-gray-active rounded ">

        <table id="pendingSWP" class="table table-striped table-bordered table-responsive-lg ">
            <thead class="bg-info text-white">

                <tr role="row">
                    <th style="text-align:center">
                        <input type="checkbox" class="" name="selectAll" id="selectAll">
                    </th>
                    <th>Empno</th>
                    <th>Name</th>
                    <th>Parent</th>
                    <th>Grade</th>
                    <th>Emp Type</th>
                    <th>
                        SWP <br />
                        Accepted
                    </th>
                    <th>
                        HoD<br />
                        Approved
                    </th>
                    <th>Reject</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var emp in Model.SwpVuEmpResponseList)
                {
                    <tr>

                        <td style="text-align:center">

                            @if (@emp.HodApproveVisible.Trim() == "Yes" && @emp.IsHodApproved.Trim() == "Pending" && @ViewData["FilterVal"].ToString() == "Pending")
                            {
                                <input type="checkbox" value="@emp.Empno" id="ChkEmpNo" name="ChkEmpNo"
                                class=" " />
                            }
                            else
                            {
                            }
                        </td>
                        <td>@emp.Empno</td>
                        <td>@emp.Name</td>
                        <td>@emp.Parent</td>
                        <td>@emp.Grade </td>
                        <td>@emp.Emptype </td>
                        <td>@emp.IsPolicyAccepted </td>
                        <td>@emp.IsHodApproved </td>
                        <td style="text-align:center">
                            @if (@emp.HodApproveVisible.Trim() == "Yes" && @emp.IsHodApproved.Trim() == "Pending" && @ViewData["FilterVal"].ToString() == "Pending")
                            {
                                <a onclick='Reject("HoDEmpPolicyManage/Reject?Empno=@emp.Empno")'
                            class='btn btn-danger btn-sm text-white m-1'
                            title="Reject"
                            style="cursor:pointer;">
                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <div id="result"></div>
    </div>
</div>

</form>

@section Scripts
{
<script>
    $(document).ready(function() {
        $("#pendingSWP").DataTable({
            columnDefs: [{
                targets: [0, 7], // column index (start from 0)
                orderable: false, // set orderable false for selected columns
            }],
            'columnDefs': [{ 'orderable': false, 'targets': [0, 7] }], // hide sort icon on header of first column
            'aaSorting': [[1, 'asc']] // start to sort data in second column

        });

    });
    $("#selectAll").change(function() {
        var isChecked = this.checked;
        $('#pendingSWP td input:checkbox').prop('checked', isChecked);
    });

    //function DdlChangeEvent() {
    //    var vText = $("#ddlFilterList option:selected").text();
    //    var vVal = $("#ddlFilterList option:selected").val();
    //     $.ajax(
    //        {
    //             url: '/HoDEmpPolicyManage/Index?vFilterBy=' + vVal,
    //            type: 'POST',
    //            data: "",
    //            contentType: 'application/json; charset=utf-8',
    //            success: function (data) {
    //                this.form.submit();
    //            },
    //            error: function () {
    //                toastr.error("error");
    //            }
    //        });

    //}

    function Reject(url) {
        swal({
            title: "Are you sure you want to reject?",
            text: "You will not be able to restore the content!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, reject it!",
            closeOnconfirm: true
        }, function() {
            $.ajax({
                type: "POST",
                url: url,
                success: function(data) {
                    if (data.success) {
                        toastr.success(data.message);
                        setTimeout(function() {
                            window.location.reload();
                        }, 700);
                    } else {
                        toastr.error(data.message);
                    }
                }
            });
        });
    }
</script>
}